<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>注册</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
<meta name="apple-mobile-web-app-capable" content="yes">
<link href="static/css/style.css" rel="stylesheet" type="text/css">
<link href="static/css/index_017.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="static/js/jquery_2_1_4.js"></script>
<script type="text/javascript" src="static/js/common.js"></script>
</head>

<body>
<header>
<div class="header01">
    <a href="index.html"><img src="static/picture/logo.png" title="铂澜咖啡学院BloomCoffeeCollege"></a>
</div>
    <div class="header02">
<a href="javascript:void(0);" id="fanhui_btn" class="header_left"><span class="fanhui">返回</span></a>
<h1>注册</h1>
	</div>
</header>

<div class="wp_100">
<div class="header_top"></div>
<div class="clear"></div>
<!--头部结束内容开始-->
<div class="wp_640">
	<div class="tit_01">
<ul>
<li><input type="text" name="username" id="username" class="text_t1" placeholder="输入手机号" value=""></li>
<li><input type="password" name="password" id="pwd" class="text_t1" placeholder="输入密码" value=""></li>
<li><input type="password" name="q_pwd" id="q_pwd" class="text_t1" placeholder="确认密码" value=""></li>
<li class="yzm_li"><input type="text" id='code' class="text_t1" placeholder="确认验证码" value=""><a href="javascript:getcode();" class="yzm" style="width:2.96rem">获取验证码</a></li>
<li class="xy">
<div class="xuanzek">
 <input type="checkbox" id="dxz_01_03" name="zhucexieyi" value="1" checked="true" class="duo_checkbox03" style="display: none;"><label for="dxz_01_03"><a href="javascript:;">我同意并遵守用户协议</a></label>
   </div>
</li>

<li><a href="javascript:tjzhuce();" class="tij">注册</a></li>
</ul>
<div class="clear"></div>
</div>
</div>


</div>
<script>
	//提交注册信息
	function tjzhuce(){
        var pwd = $("#pwd").val();
        var q_pwd = $("#q_pwd").val();
        var mobile = $('#username').val();
        var code=$("#code").val();
		var xieyi=$("input[name='zhucexieyi']:checked").val(); 
		if(mobile==''){
			alert('您没有输入手机号码，暂时无法执行此操作！');return;
		}
		var mobileReg = /^1[3|4|5|7|8][0-9]\d{8}$/;	
		if(!mobileReg.test(mobile)){
			alert('请输入有效手机号！');return;
		}
        if(pwd==''){
            alert("请输入密码！");return;
        }
        if(pwd.length<6){
            alert("密码长度不可小于六位！"); return;
        }
		if(pwd.length>20){
            alert("密码长度不可大于二十位！"); return;
        }
        if(q_pwd==''){
            alert("请确认密码！"); return;
        }
        if(pwd!=q_pwd){
            alert("密码与确认密码不一致"); return;
        }
		if(code==''){
			alert("请输入验证码！");return;
		}
		if(xieyi!=1){
			alert("请先阅读协议！");return;
		}
        $.ajax({
            "type" : "post",
            "async" : false,
            "dataType" : "json",
            "url" : "/index.php?s=/Index/User/register2.html",
            "data" : {
                "username":mobile,
                "password":pwd,
                "invcode":code
            },
            "success" : function(ret) {
                if(ret.data==-1){
                    alert('验证码错误');return;
                }				
				if(ret==1){
                    alert('注册成功');
                    location.href="/index.php?s=/Index/User/index.html";return;
                }
				if(ret==-2){
                    alert('账号已存在');return;
                }
				if(ret==-3){
                    alert('注册失败');return;
                }
				if(ret==-4){
                    alert('未发送验证码');return;
                }

            }
        });
	}

	//获取验证码
	var InterValObj; //timer变量，控制时间
	var codeLength = 6;
	var code = ""; //清除验证码
	var count = 120; //间隔函数，1秒执行
	var curCount;//当前剩余秒数
	var cishu=1;
	function getcode(){
		if(cishu!=1){
			cishu=1;return;
		}else{
			cishu+=1;
		}
		var mobile=$('#username').val();
		if(mobile==''){
			alert('您没有输入手机号码，暂时无法执行此操作！');return;
		}
		var mobileReg = /^1[3|4|5|7|8][0-9]\d{8}$/;	
		if(!mobileReg.test(mobile)){
			alert('请输入有效手机号！');return;
		}
		for (var i = 0; i < codeLength; i++) {
            code += parseInt(Math.random() * 9).toString();
        }
		curCount=count;
		 $.ajax({
			"type" : "post",
			"async" : false,
			"dataType" : "json",
			"url" : "/index.php?s=/Index/User/putmobileverify.html",
			"data" : {
				"mobile":mobile,
				"code":code
			},
			"success" : function(ret) {
				if(ret.status){
					$('.yzm').text("119 秒后请重新获取");
					InterValObj = window.setInterval('SetRemainTime()', 1000); //启动计时器，1秒执行一次
				}else{
					alert(ret.message);
				}
			}
		});
	}
	//计时器
	function SetRemainTime(){
		if (curCount == 0) {
            window.clearInterval(InterValObj);//停止计时器
			$(".yzm").attr('href','javascript:getcode();');
            $(".yzm").text("获取短信验证码");
        }
        else {
            curCount--;
			$(".yzm").attr('href','javascript:vode(0);');
            $(".yzm").text(curCount+' 秒后请重新获取');
        }
	}
</script>
</body>
</html>